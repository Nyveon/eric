<style>
	canvas {
		position: absolute;
	}
</style>

<canvas></canvas>

<script>
	import { world, step } from "@scripts/boids/game";
	import { $ } from "astro:scoped";
	import { addComponent, addEntity } from "bitecs";
	import { Application, Assets, Sprite } from "pixi.js";

	const view = $("canvas") as HTMLCanvasElement;

	(async () => {
		const app = new Application();
		await app.init({
			backgroundAlpha: 0,
			resizeTo: view.parentElement!,
			canvas: view,
		});

		const texture = await Assets.load("https://pixijs.com/assets/bunny.png");
		const bunny = new Sprite(texture);
		bunny.anchor.set(0.5);
		app.stage.addChild(bunny);

		const { Position, Rotation, GameSprite } = world.components;

		const entity = addEntity(world);
		addComponent(world, entity, Position);
		Position.x[entity] = app.screen.width / 2;
		Position.y[entity] = app.screen.height / 2;
		addComponent(world, entity, Rotation);
		Rotation.angle[entity] = 0;
		addComponent(world, entity, GameSprite);
		GameSprite.sprite[entity] = bunny;

		app.ticker.add((time) => {
			step(time.deltaTime);
		});
	})();
</script>
